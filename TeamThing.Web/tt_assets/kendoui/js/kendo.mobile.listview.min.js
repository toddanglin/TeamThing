/*
* Kendo UI Complete v2012.1.515 (http://kendoui.com)
* Copyright 2012 Telerik AD. All rights reserved.
*
* Kendo UI Complete commercial licenses may be obtained at http://kendoui.com/complete-license
* If you do not own a commercial license, this file shall be governed by the trial license terms.
*/
(function(a,b){function C(b,c){c=a(c);if(!!c.children("input[type=checkbox],input[type=radio]").length){var d=c.parent();if(d.contents().not(c).not(function(){return this.nodeType==3})[0])return;c.addClass("km-listview-label")}}function B(b,d){d=a(d);var e=d.parent(),f=d.add(e.children("[data-"+c.ns+"role=detailbutton]")),g=e.contents().not(f).not(z);if(!g.length){var h=e.data(c.ns+"icon"),i=a('<span class="km-icon"/>');d.addClass("km-listview-link").attr(c.attr("role"),"listview-link"),h&&(d.prepend(i),i.addClass("km-"+h))}}function A(b,d){d=a(d);var e=d.data(c.ns+"icon"),f=a('<span class="km-icon"/>');e&&(d.prepend(f),f.addClass("km-"+e))}function z(){return this.nodeType===d.TEXT_NODE&&this.nodeValue.match(/^\s+$/)}function y(b){if(!(b.which>1)){var d=a(b.currentTarget),e=d.parent(),f=d.data(c.ns+"role")||"",g=!f.match(/button/),h=b.originalEvent&&b.originalEvent.defaultPrevented;g&&e.toggleClass("km-state-active",b.type===s&&!h);if(d.is("label")&&b.type===v&&!h){var i=d.find("input"),j=i.attr("type"),k=!i[0].checked;j==="radio"&&(k=!0),i[0].checked=k}}}var c=window.kendo,d=window.Node,e=c.mobile,f=e.ui,g=c.support,h=c.data.DataSource,i=f.Widget,j=".km-list > li",k=".km-list > li > .km-listview-link, .km-list > li > .km-listview-label",l=".km-list > li > .km-listview-label > input",m=a.proxy,n="km-group-title",o='<div class="'+n+'"><span class="km-text"></span></div>',p=c.template('<li><div class="'+n+'">#= this.headerTemplate(data) #</div><ul>#= kendo.render(this.template, data.items)#</ul></li>'),q='<div class="km-listview-wrapper" />',r="function",s=g.mousedown,t=g.mousemove,u=g.mousecancel,v=g.mouseup,w="click",x="requestStart",D=i.extend({init:function(a,b){var d=this;i.fn.init.call(d,a,b),b=d.options,d.element.on([s,v,t,u].join(" "),k,y).on("click",l,function(a){a.preventDefault()}).on(v,j,m(d._click,d)),d.element.wrap(q),d.wrapper=d.element.parent(),d._footer(),d._dataSource(),d._bindScroller(),b.dataSource?d.dataSource.fetch():d._style(),c.notify(d,f)},events:[w],options:{name:"ListView",type:"flat",template:"${data}",headerTemplate:'<span class="km-text">${value}</span>',appendOnRefresh:!1,loadMore:!1,loadMoreText:"Press to load more",endlessScroll:!1,scrollTreshold:30,pullToRefresh:!1,pullTemplate:"Pull to refresh",releaseTemplate:"Release to refresh",refreshTemplate:"Refreshing",pullOffset:140,style:""},setOptions:function(a){i.fn.setOptions.call(this,a)},setDataSource:function(a){this.options.dataSource=a,this._dataSource(),a.fetch()},_dataSource:function(){var a=this,b=a.options;a.dataSource&&a._refreshHandler?a.dataSource.unbind("change",a._refreshHandler).unbind(x,a._showLoading):a._refreshHandler=m(a.refresh,a),a.dataSource=h.create(b.dataSource).bind("change",a._refreshHandler),!b.pullToRefresh&&!b.loadMore&&!b.endlessScroll&&a.dataSource.bind(x,a._showLoading)},_bindScroller:function(){var a=this,b=a.options,c=a.dataSource,d=a._scroller();!d||(b.pullToRefresh&&d.setOptions({pullToRefresh:!0,pull:function(){c.read()},pullTemplate:b.pullTemplate,releaseTemplate:b.releaseTemplate,refreshTemplate:b.refreshTemplate}),b.endlessScroll&&(a._scrollHeight=d.element.height(),d.setOptions({resize:function(){a._scrollHeight=d.element.height(),a._calcTreshold()},scroll:function(b){!a.loading&&b.scrollTop+a._scrollHeight>a._treshold&&(a.loading=!0,a._toggleIcon(!0),c.next())}})))},_calcTreshold:function(){var a=this,b=a._scroller();b&&(a._treshold=b.scrollHeight()-a.options.scrollTreshold)},refresh:function(b){b=b||{};var d=this,g=d.element,h=d.options,i=d.dataSource,j=i.view(),k=d.loading,l=k?"append":"html",m,n,o;b.action==="itemchange"?(n=b.items[0],o=a(d.template(n)),g.find("[data-"+c.ns+"uid="+n.uid+"]").replaceWith(o),d.trigger("itemChange",{item:o,data:n,ns:f})):(d.template||d._templates(),d.trigger("dataBinding"),i.group()[0]?(h.type="group",m=c.render(d.groupTemplate,j)):m=c.render(d.template,j),h.appendOnRefresh&&(l="prepend"),g[l](m),k&&(d.loading=!1,h.loadMore?d._toggleButton(!0):d._toggleIcon(!1)),h.pullToRefresh&&d._scroller().pullHandled(),e.init(g.children()),d._hideLoading(),d._style(),d.trigger("dataBound",{ns:f}))},_templates:function(){var b=this,d=b.options.template,e=b.options.headerTemplate,f="",g={},h={};if(b.dataSource.group()[0]||b.dataSource.view()[0]instanceof c.data.ObservableObject)f=' data-uid="#=uid#"';typeof d===r&&(g.template=d,d="#=this.template(data)#"),h.template=b.template=a.proxy(c.template("<li"+f+">"+d+"</li>"),g),typeof e===r&&(h._headerTemplate=e,e="#=this._headerTemplate(data)#"),h.headerTemplate=c.template(e),b.groupTemplate=a.proxy(p,h)},_click:function(b){if(!(b.which>1||b.isDefaultPrevented())){var d=this,e,g=a(b.currentTarget),h=a(b.target),i=h.closest(c.roleSelector("button","detailbutton","backbutton")),j=c.widgetInstance(i,f),k=g.attr(c.attr("uid"));k&&(e=d.dataSource.getByUid(k)),d.trigger(w,{target:h,item:g,dataItem:e,button:j})&&b.preventDefault()}},items:function(){return this.options.type==="group"?this.element.find(".km-list").children():this.element.children()},_style:function(){var b=this,c,d,e,f,g,h=b.options,i=h.type==="group",j=b.element,k=h.style==="inset";j.addClass("km-listview").toggleClass("km-list",!i).toggleClass("km-listinset",!i&&k).toggleClass("km-listgroup",i&&!k).toggleClass("km-listgroupinset",i&&k),i&&(j.children().children("ul").addClass("km-list"),j.children("li").each(function(){var b=a(this).contents().first();!b.is("ul")&&!b.is("div."+n)&&b.wrap(o)})),c=b.items(),c.each(function(){var a=this,b=!1;for(d=0,e=a.childNodes.length;d<e;d++)f=a.childNodes[d],g=f.nodeName.toUpperCase(),g=="A"&&(B(d,f),b=!0),g=="LABEL"&&(C(d,f),b=!0);b||A(d,a)}),j.closest(".km-content").toggleClass("km-insetcontent",k)},_footer:function(){var b=this,c=b.options,d=c.loadMore,e;if(d||c.endlessScroll)b._loadIcon=a('<span style="display:none" class="km-icon"></span>'),e=a('<span class="km-load-more"></span>').append(b._loadIcon),d&&(b._loadButton=a('<button class="km-load km-button">'+c.loadMoreText+"</button>").click(function(){b.loading=!0,b._toggleButton(!1),b.dataSource.next()}),e.append(b._loadButton)),b.wrapper.append(e)},_toggleButton:function(a){this._loadButton.toggle(a),this._toggleIcon(!a)},_toggleIcon:function(a){var b=this._loadIcon;a?b.css("display","block"):b.hide()},_scroller:function(){var a=this.view();return a&&a.scroller},_showLoading:function(){e.application&&e.application.showLoading()},_hideLoading:function(){e.application&&e.application.hideLoading()}});f.plugin(D)})(jQuery)