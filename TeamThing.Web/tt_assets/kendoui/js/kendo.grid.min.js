/*
* Kendo UI Complete v2012.1.515 (http://kendoui.com)
* Copyright 2012 Telerik AD. All rights reserved.
*
* Kendo UI Complete commercial licenses may be obtained at http://kendoui.com/complete-license
* If you do not own a commercial license, this file shall be governed by the trial license terms.
*/
(function(a,b){function bc(a,b){var c,d,e;if(typeof a===Q)return a===b;if(m(a))for(c=0,d=a.length;c<d;c++){e=a[c];if(typeof e===Q&&e===b||e.name===b)return!0}return!1}function ba(a,b,c){var d=a.eq(b),e=a.eq(c);d[b>c?"insertBefore":"insertAfter"](e)}function _(a){var b,c,d={};if(!p(a))if(m(a))for(b=0,c=a.length;b<c;b++)d[a[b].field]={};else d[a.field]={};return d}function $(b,c){a("th, th .k-grid-filter, th .k-link",b).add(document.body).css("cursor",c)}function Z(b){var c=0;a("> .k-grouping-header, > .k-grid-toolbar",b).each(function(){c+=this.offsetHeight});return c}function X(a){return Array(a+1).join('<td class="k-group-cell">&nbsp;</td>')}var c=window.kendo,d=c.ui,e=c.data.DataSource,f=d.Groupable,g=c.support.tbodyInnerHtml,h=d.Widget,i=c.keys,j=a.isPlainObject,k=a.extend,l=a.map,m=a.isArray,n=a.proxy,o=a.isFunction,p=a.isEmptyObject,q=Math,r="requestStart",s="error",t="tbody>tr:not(.k-grouping-row,.k-detail-row,.k-group-footer):visible",u=":not(.k-group-cell,.k-hierarchy-cell):visible",v="tbody>tr:not(.k-grouping-row,.k-detail-row,.k-group-footer) > td:not(.k-group-cell,.k-hierarchy-cell)",w=t+">td"+u,x=w+":first",y="edit",z="save",A="remove",B="detailInit",C="change",D="saveChanges",E="dataBound",F="detailExpand",G="detailCollapse",H="k-state-focused",I="k-focusable",J="k-state-selected",K="columnResize",L="columnReorder",M="click",N="height",O="tabIndex",P="function",Q="string",R="Are you sure you want to delete this record?",S=/\}/ig,T=3,U=/#/ig,V='<a class="k-button k-button-icontext #=className#" #=attr# href="\\#"><span class="#=iconClass# #=imageClass#"></span>#=text#</a>',W=h.extend({init:function(a,b){var c=this;h.fn.init.call(c,a,b),c._refreshHandler=n(c.refresh,c),c.setDataSource(b.dataSource),c.wrap()},setDataSource:function(a){var b=this;b.dataSource&&b.dataSource.unbind(C,b._refreshHandler),b.dataSource=a,b.dataSource.bind(C,b._refreshHandler)},options:{name:"VirtualScrollable",itemHeight:a.noop},wrap:function(){var b=this,d=c.support.scrollbar()+1,e=b.element;e.css({width:"auto",paddingRight:d,overflow:"hidden"}),b.content=e.children().first(),b.wrapper=b.content.wrap('<div class="k-virtual-scrollable-wrap"/>').parent().bind("DOMMouseScroll",n(b._wheelScroll,b)).bind("mousewheel",n(b._wheelScroll,b)),c.support.touch&&(b.drag=new c.Drag(b.wrapper,{global:!0,move:function(a){b.verticalScrollbar.scrollTop(b.verticalScrollbar.scrollTop()-a.y.delta),a.preventDefault()}})),b.verticalScrollbar=a('<div class="k-scrollbar k-scrollbar-vertical" />').css({width:d}).appendTo(e).bind("scroll",n(b._scroll,b))},_wheelScroll:function(b){var c=this,d=c.verticalScrollbar.scrollTop(),e=b.originalEvent,f;b.preventDefault(),e.wheelDelta?f=e.wheelDelta:e.detail?f=-e.detail*10:a.browser.opera&&(f=-e.wheelDelta),c.verticalScrollbar.scrollTop(d+ -f)},_scroll:function(a){var b=this,c=a.currentTarget.scrollTop,d=b.dataSource,e=b.itemHeight,f=d.skip()||0,g=b._rangeStart||f,h=b.element.innerHeight(),i=!!(b._scrollbarTop&&b._scrollbarTop>c),j=q.max(q.floor(c/e),0),k=q.max(j+q.floor(h/e),0);b._scrollTop=c-g*e,b._scrollbarTop=c,b._fetch(j,k,i)||(b.wrapper[0].scrollTop=b._scrollTop)},_fetch:function(a,b,c){var d=this,e=d.dataSource,f=d.itemHeight,g=e.take(),h=d._rangeStart||e.skip()||0,i=q.floor(a/g)*g,j=!1,k=.33;a<h?(j=!0,h=q.max(0,b-g),d._scrollTop=(a-h)*f,d._page(h,g)):b>=h+g&&!c?(j=!0,h=a,d._scrollTop=f,d._page(h,g)):d._fetching||(a<i+g-g*k&&a>g&&e.prefetch(i-g,g),b>i+g*k&&e.prefetch(i+g,g));return j},_page:function(a,b){var d=this,e=d.dataSource;clearTimeout(d._timeout),d._fetching=!0,d._rangeStart=a,e.inRange(a,b)?e.range(a,b):(c.ui.progress(d.wrapper.parent(),!0),d._timeout=setTimeout(function(){e.range(a,b)},100))},refresh:function(){var a=this,b="",d=25e4,e=a.dataSource,f=a._rangeStart,g=c.support.scrollbar(),h=a.wrapper[0],i,j,k;c.ui.progress(a.wrapper.parent(),!1),clearTimeout(a._timeout),k=a.itemHeight=a.options.itemHeight()||0;var l=h.scrollWidth>h.offsetWidth?g:0;i=e.total()*k+l;for(j=0;j<q.floor(i/d);j++)b+='<div style="width:1px;height:'+d+'px"></div>';i%d&&(b+='<div style="width:1px;height:'+i%d+'px"></div>'),a.verticalScrollbar.html(b),h.scrollTop=a._scrollTop,a.drag&&a.drag.cancel(),f&&!a._fetching&&(a._rangeStart=e.skip()),a._fetching=!1}}),Y={create:{text:"Add new record",imageClass:"k-add",className:"k-grid-add",iconClass:"k-icon"},cancel:{text:"Cancel changes",imageClass:"k-cancel",className:"k-grid-cancel-changes",iconClass:"k-icon"},save:{text:"Save changes",imageClass:"k-update",className:"k-grid-save-changes",iconClass:"k-icon"},destroy:{text:"Delete",imageClass:"k-delete",className:"k-grid-delete",iconClass:"k-icon"},edit:{text:"Edit",imageClass:"k-edit",className:"k-grid-edit",iconClass:"k-icon"},update:{text:"Update",imageClass:"k-update",className:"k-grid-update",iconClass:"k-icon"},canceledit:{text:"Cancel",imageClass:"k-cancel",className:"k-grid-cancel",iconClass:"k-icon"}},bb=h.extend({init:function(a,b){var d=this;b=m(b)?{dataSource:b}:b,h.fn.init.call(d,a,b),d._element(),d._columns(d.options.columns),d._dataSource(),d._tbody(),d._pageable(),d._toolbar(),d._thead(),d._groupable(),d._templates(),d._navigatable(),d._selectable(),d._details(),d._editable(),d.options.autoBind&&d.dataSource.fetch(),c.notify(d)},events:[C,"dataBinding",E,F,G,B,y,z,A,D,K,L],setDataSource:function(a){var b=this;b.options.dataSource=a,b._dataSource(),b._pageable(),b.options.groupable&&b._groupable(),b._thead(),b.virtualScrollable&&b.virtualScrollable.setDataSource(b.options.dataSource),b.options.autoBind&&a.fetch()},options:{name:"Grid",columns:[],toolbar:null,autoBind:!0,filterable:!1,scrollable:!0,sortable:!1,selectable:!1,navigatable:!1,pageable:!1,editable:!1,groupable:!1,rowTemplate:"",altRowTemplate:"",dataSource:{},height:null,resizable:!1,reorderable:!1},setOptions:function(a){var b=this;h.fn.setOptions.call(this,a),b._templates()},items:function(){return this.tbody.children(":not(.k-grouping-row,.k-detail-row,.k-group-footer)")},_element:function(){var b=this,c=b.element;c.is("table")||(c=a("<table />").appendTo(b.element)),b.table=c.attr("cellspacing",0),b._wrapper()},positionColumnResizeHandles:function(){var b=this,c=0,d,e=b.options.scrollable,f=e?b.wrapper.find(".k-grid-header-wrap"):b.wrapper;b.options.resizable&&(f.find("> .k-resize-handle").remove(),b.thead.find("th").each(function(){c+=this.offsetWidth,d=a(this),d.is(":not(.k-group-cell,.k-hierarchy-cell)")&&a('<div class="k-resize-handle" />').css({left:c-T,top:e?0:Z(b.wrapper),width:T*2}).appendTo(f).data("th",d)}))},_resizable:function(){var b=this,d=b.options,e,f,g,h,i;d.resizable&&(e=d.scrollable?b.wrapper.find(".k-grid-header-wrap"):b.wrapper,b.positionColumnResizeHandles(),e.kendoResizable({handle:".k-resize-handle",hint:function(c){return a('<div class="k-grid-resize-indicator" />').css({height:c.data("th").outerHeight()+b.tbody.attr("clientHeight")})},start:function(c){var e=a(c.currentTarget).data("th"),j=a.inArray(e[0],e.parent().children(":visible")),k=b.tbody.parent(),l=b.footer||a();$(b.wrapper,e.css("cursor")),d.scrollable?i=b.thead.parent().find("col:eq("+j+")").add(k.children("colgroup").find("col:eq("+j+")")).add(l.find("colgroup").find("col:eq("+j+")")):i=k.children("colgroup").find("col:eq("+j+")"),f=c.pageX,g=e.outerWidth(),h=b.tbody.outerWidth()},resize:function(c){var e=g+c.pageX-f,j=b.footer||a(),k=0;e>10&&(i.css("width",e),d.scrollable&&(b._footerWidth=h+c.pageX-f,b.tbody.parent().add(b.thead.parent()).add(j.find("table")).css("width",b._footerWidth)),a(".k-resize-handle",b.wrapper).each(function(){k+=a(this).data("th").outerWidth(),a(this).css("left",k-T)}))},resizeend:function(d){var e=a(d.currentTarget).data("th"),f=e.outerWidth(),h;$(b.wrapper,""),g!=f&&(h=b.columns[e.parent().find("th:not(.k-group-cell,.k-hierarchy-cell)").index(e)],h.width=f,b.trigger(K,{column:h,oldWidth:g,newWidth:f})),b.positionColumnResizeHandles(),b._hasDetails()&&b.tbody.find(">tr.k-detail-row ["+c.attr("role")+"=grid]").kendoGrid("positionColumnResizeHandles")}}))},_draggable:function(){var b=this;b.options.reorderable&&(b._draggableInstance=b.thead.kendoDraggable({group:c.guid(),filter:".k-header:not(.k-group-cell,.k-hierarchy-cell)["+c.attr("field")+"]",hint:function(b){return a('<div class="k-header k-drag-clue" />').css({width:b.width(),paddingLeft:b.css("paddingLeft"),paddingRight:b.css("paddingRight"),lineHeight:b.height()+"px",paddingTop:b.css("paddingTop"),paddingBottom:b.css("paddingBottom")}).html(b.attr(c.attr("title"))||b.attr(c.attr("field"))).prepend('<span class="k-icon k-drag-status k-denied" />')}}).data("kendoDraggable"))},_reorderable:function(){var a=this;a.options.reorderable&&a.thead.kendoReorderable({draggable:a._draggableInstance,change:function(b){var c=a.columns[b.oldIndex];a.trigger(L,{newIndex:b.newIndex,oldIndex:b.oldIndex,column:c}),a.reorderColumn(b.newIndex,c)}})},reorderColumn:function(b,d){var e=this,f=a.inArray(d,e.columns),g,h,i;if(f!==b){e.columns.splice(f,1),e.columns.splice(b,0,d),e._templates(),ba(e.thead.prev().find("col:not(.k-group-col,.k-hierarchy-col)"),f,b),e.options.scrollable&&ba(e.tbody.prev().find("col:not(.k-group-col,.k-hierarchy-col)"),f,b),ba(e.thead.find(".k-header:not(.k-group-cell,.k-hierarchy-cell)"),f,b),e.footer&&(ba(e.footer.find(".k-grid-footer-wrap>table>colgroup>col:not(.k-group-col,.k-hierarchy-col)"),f,b),ba(e.footer.find(".k-footer-template>td:not(.k-group-cell,.k-hierarchy-cell)"),f,b)),g=e.tbody.children(":not(.k-grouping-row,.k-detail-row)");for(h=0,i=g.length;h<i;h+=1)ba(g.eq(h).find(">td:not(.k-group-cell,.k-hierarchy-cell)"),f,b);e.options.resizable&&(e.positionColumnResizeHandles(),e._hasDetails()&&e.tbody.find(">tr.k-detail-row ["+c.attr("role")+"=grid]").kendoGrid("positionColumnResizeHandles"))}},cellIndex:function(b){return a(b).parent().find("td:not(.k-group-cell,.k-hierarchy-cell)").index(b)},_modelForContainer:function(a){!a.is("tr")&&this._editMode()!=="popup"&&(a=a.closest("tr"));var b=a.attr(c.attr("uid"));return this.dataSource.getByUid(b)},_editable:function(){var b=this,c=b.options.editable,d=function(){var c=document.activeElement,d=b._editContainer;d&&!a.contains(d[0],c)&&d[0]!==c&&!a(c).closest(".k-animation-container").length&&b.editable.end()&&b.closeCell()};if(c){var e=b._editMode();e==="incell"?c.update!==!1&&(b.wrapper.delegate("tr:not(.k-grouping-row) > td:not(.k-hierarchy-cell,.k-detail-cell,.k-group-cell,.k-edit-cell,:has(a.k-grid-delete))",M,function(c){var d=a(this);d.closest("tbody")[0]===b.tbody[0]&&!a(c.target).is(":input")&&(b.editable?b.editable.end()&&(b.closeCell(),b.editCell(d)):b.editCell(d))}),b.wrapper.bind("focusin",function(a){clearTimeout(b.timer),b.timer=null}),b.wrapper.bind("focusout",function(a){b.timer=setTimeout(d,1)})):c.update!==!1&&b.wrapper.delegate("tbody>tr:not(.k-detail-row,.k-grouping-row):visible a.k-grid-edit",M,function(c){c.preventDefault(),b.editRow(a(this).closest("tr"))}),c.destroy!==!1&&b.wrapper.delegate("tbody>tr:not(.k-detail-row,.k-grouping-row):visible a.k-grid-delete",M,function(c){c.preventDefault(),b.removeRow(a(this).closest("tr"))})}},editCell:function(a){var b=this,c=b.columns[b.cellIndex(a)],d=b._modelForContainer(a);d&&(!d.editable||d.editable(c.field))&&!c.command&&c.field&&(b._attachModelChange(d),b._editContainer=a,b.editable=a.addClass("k-edit-cell").kendoEditable({fields:{field:c.field,format:c.format,editor:c.editor},model:d,change:function(c){b.trigger(z,{values:c.values,container:a,model:d})&&c.preventDefault()}}).data("kendoEditable"),a.parent().addClass("k-grid-edit-row"),b.trigger(y,{container:a,model:d}))},_destroyEditable:function(){var a=this;a.editable&&(a._detachModelChange(),a.editable.destroy(),delete a.editable,a._editMode()==="popup"&&a._editContainer.data("kendoWindow").close(),a._editContainer=null)},_attachModelChange:function(a){var b=this;b._modelChangeHandler=function(a){b._modelChange({field:a.field,model:this})},a.bind("change",b._modelChangeHandler)},_detachModelChange:function(){var a=this,b=a._editContainer,c=a._modelForContainer(b);c&&c.unbind(C,a._modelChangeHandler)},closeCell:function(){var b=this,d=b._editContainer.removeClass("k-edit-cell"),e=d.closest("tr").attr(c.attr("uid")),f=b.columns[b.cellIndex(d)],g=b.dataSource.getByUid(e);d.parent().removeClass("k-grid-edit-row"),b._destroyEditable(),b._displayCell(d,f,g),d.hasClass("k-dirty-cell")&&a('<span class="k-dirty"/>').prependTo(d)},_displayCell:function(a,b,d){var e=this,f={storage:{},count:0},g=k({},c.Template,e.options.templateSettings),h=c.template(e._cellTmpl(b,f),g);f.count>0&&(h=n(h,f.storage)),a.empty().html(h(d))},removeRow:function(b){var c=this,d,e;!c._confirmation()||(b=a(b).hide(),d=c._modelForContainer(b),d&&!c.trigger(A,{row:b,model:d})&&(c.dataSource.remove(d),e=c._editMode(),(e==="inline"||e==="popup")&&c.dataSource.sync()))},_editMode:function(){var a="incell",b=this.options.editable;b!==!0&&(a=b.mode||b);return a},editRow:function(a){var b=this,c=b._modelForContainer(a),d;b.cancelRow(),c&&(b._attachModelChange(c),b._editMode()==="popup"?b._createPopupEditor(c):b._createInlineEditor(a,c),d=b._editContainer,d.delegate("a.k-grid-cancel",M,function(a){a.preventDefault(),b.cancelRow()}),d.delegate("a.k-grid-update",M,function(a){a.preventDefault(),b.saveRow()}))},_createPopupEditor:function(b){var d=this,e="<div "+c.attr("uid")+'="'+b.uid+'"><div class="k-edit-form-container">',f,g=[],h,i,l,m=d.options.editable,o=j(m)?m.window:{},p=k({},c.Template,d.options.templateSettings);if(m.template)e+=c.template(m.template,p)(b);else for(h=0,i=d.columns.length;h<i;h++){f=d.columns[h];if(!f.command){e+='<div class="k-edit-label"><label for="'+f.field+'">'+(f.title||f.field||"")+"</label></div>";if((!b.editable||b.editable(f.field))&&f.field)g.push({field:f.field,format:f.format,editor:f.editor}),e+="<div "+c.attr("container-for")+'="'+f.field+'" class="k-edit-field"></div>';else{var q={storage:{},count:0};l=c.template(d._cellTmpl(f,q),p),q.count>0&&(l=n(l,q.storage)),e+='<div class="k-edit-field">'+l(b)+"</div>"}}}e+=d._createButton("update")+d._createButton("canceledit"),e+="</div></div>";var r=d._editContainer=a(e).appendTo(d.wrapper).kendoWindow(k({modal:!0,resizable:!1,draggable:!0,title:"Edit",visible:!1},o)),s=r.data("kendoWindow");s.wrapper.delegate(".k-close","click",function(){d.cancelRow()}),d.editable=d._editContainer.kendoEditable({fields:g,model:b,clearContainer:!1}).data("kendoEditable"),s.center().open(),d.trigger(y,{container:r,model:b})},_createInlineEditor:function(b,c){var d=this,e,f,g=[];b.children(":not(.k-group-cell,.k-hierarchy-cell)").each(function(){f=a(this),e=d.columns[d.cellIndex(f)],!e.command&&e.field&&(!c.editable||c.editable(e.field))?(g.push({field:e.field,format:e.format,editor:e.editor}),f.attr("data-container-for",e.field),f.empty()):e.command&&bc(e.command,"edit")&&(f.empty(),a(d._createButton("update")+d._createButton("canceledit")).appendTo(f))}),d._editContainer=b,d.editable=b.addClass("k-grid-edit-row").kendoEditable({fields:g,model:c,clearContainer:!1}).data("kendoEditable"),d.trigger(y,{container:b,model:c})},cancelRow:function(){var a=this,b=a._editContainer,d;b&&(d=a._modelForContainer(b),a.dataSource.cancelChanges(d),a._editMode()!=="popup"?a._displayRow(b):a._displayRow(a.items().filter("["+c.attr("uid")+"="+d.uid+"]")),a._destroyEditable())},saveRow:function(){var a=this,b=a._editContainer,c=a._modelForContainer(b),d=a.editable;b&&d&&d.end()&&!a.trigger(z,{container:b,model:c})&&(a._editMode()!=="popup"&&a._displayRow(b),a._destroyEditable(),a.dataSource.sync())},_displayRow:function(b){var c=this,d=c._modelForContainer(b);d&&b.replaceWith(a((b.hasClass("k-alt")?c.altRowTemplate:c.rowTemplate)(d)))},_showMessage:function(a){return window.confirm(a)},_confirmation:function(){var a=this,b=a.options.editable,c=b===!0||typeof b===Q?R:b.confirmation;return c!==!1&&c!=null?a._showMessage(c):!0},cancelChanges:function(){this.dataSource.cancelChanges()},saveChanges:function(){var a=this;(a.editable&&a.editable.end()||!a.editable)&&!a.trigger(D)&&a.dataSource.sync()},addRow:function(){var a=this,b,d=a.dataSource;if(a.editable&&a.editable.end()||!a.editable){b=d.indexOf((d.view()||[])[0]),b<0&&(b=0);var e=d.insert(b,{}),f=e.uid,g=a._editMode(),h=a.table.find("tr["+c.attr("uid")+"="+f+"]"),i=h.children("td:not(.k-group-cell,.k-hierarchy-cell)").first();g!=="inline"&&g!=="popup"||!h.length?i.length&&a.editCell(i):a.editRow(h)}},_toolbar:function(){var b=this,d=b.wrapper,e=b.options.toolbar,f;e&&(e=o(e)?e({}):typeof e===Q?e:b._toolbarTmpl(e).replace(U,"\\#"),f=n(c.template(e),b),a('<div class="k-toolbar k-grid-toolbar" />').html(f({})).prependTo(d).delegate(".k-grid-add",M,function(a){a.preventDefault(),b.addRow()}).delegate(".k-grid-cancel-changes",M,function(a){a.preventDefault(),b.cancelChanges()}).delegate(".k-grid-save-changes",M,function(a){a.preventDefault(),b.saveChanges()}))},_toolbarTmpl:function(a){var b=this,c,d,e="";if(m(a))for(c=0,d=a.length;c<d;c++)e+=b._createButton(a[c]);return e},_createButton:function(a){var b=a.template||V,d=typeof a===Q?a:a.name,e={className:"",text:d,imageClass:"",attr:"",iconClass:""};j(a)?e=k(!0,e,Y[d],a):e=k(!0,e,Y[d]);return c.template(b)(e)},_groupable:function(){var b=this,c=b.wrapper,d=b.options.groupable;b.groupable||b.table.delegate(".k-grouping-row .k-collapse, .k-grouping-row .k-expand",M,function(c){var d=a(this),e=d.closest("tr");d.hasClass("k-collapse")?b.collapseGroup(e):b.expandGroup(e),c.preventDefault(),c.stopPropagation()}),d&&(c.has("div.k-grouping-header")[0]||a("<div />").addClass("k-grouping-header").html(" ").prependTo(c),b.groupable&&b.groupable.destroy(),b.groupable=new f(c,{draggable:b._draggableInstance,groupContainer:"div.k-grouping-header",dataSource:b.dataSource,allowDrag:b.options.reorderable}))},_selectable:function(){var a=this,b,d,e=a.options.selectable;e&&(b=typeof e===Q&&e.toLowerCase().indexOf("multiple")>-1,d=typeof e===Q&&e.toLowerCase().indexOf("cell")>-1,a.selectable=new c.ui.Selectable(a.table,{filter:">"+(d?v:"tbody>tr:not(.k-grouping-row,.k-detail-row,.k-group-footer)"),multiple:b,change:function(){a.trigger(C)}}),a.options.navigatable&&a.wrapper.keydown(function(c){var e=a.current();c.keyCode===i.SPACEBAR&&c.target==a.wrapper[0]&&!e.hasClass("k-edit-cell")&&(c.preventDefault(),c.stopPropagation(),e=d?e:e.parent(),b?c.ctrlKey?e.hasClass(J)&&(e.removeClass(J),e=null):a.selectable.clear():a.selectable.clear(),a.selectable.value(e))}))},clearSelection:function(){var a=this;a.selectable.clear(),a.trigger(C)},select:function(b){var c=this,d=c.selectable;b=a(b);if(b.length)d.options.multiple||(d.clear(),b=b.first()),d.value(b);else return d.value()},current:function(a){var c=this,d=c.options.scrollable,e=c._current;a!==b&&a.length&&(!e||e[0]!==a[0])&&(a.addClass(H),e&&e.removeClass(H),c._current=a,a.length&&d&&(c._scrollTo(a.parent()[0],c.content[0]),d.virtual?c._scrollTo(a[0],c.content.find(">.k-virtual-scrollable-wrap")[0]):c._scrollTo(a[0],c.content[0])));return c._current},_scrollTo:function(a,b){var c=a.tagName.toLowerCase()==="td",d=a[c?"offsetLeft":"offsetTop"],e=a[c?"offsetWidth":"offsetHeight"],f=b[c?"scrollLeft":"scrollTop"],g=b[c?"clientWidth":"clientHeight"],h=d+e;b[c?"scrollLeft":"scrollTop"]=f>d?d:h>f+g?h-g:f},_navigatable:function(){var b=this,c=b.wrapper,d=b.table.addClass(I),e=n(b.current,b),f="."+I+" "+w,g=a.browser,h=function(d){var f=a(d.currentTarget);f.closest("tbody")[0]===b.tbody[0]&&(e(f),a(d.target).is(":button,a,:input,a>.k-icon,textarea,span.k-icon,.k-input")||setTimeout(function(){c.focus()}),d.stopPropagation())};b.options.navigatable&&(c.bind({focus:function(){var a=b._current;a&&a.is(":visible")?a.addClass(H):e(b.table.find(x))},focusout:function(a){b._current&&b._current.removeClass(H),a.stopPropagation()},keydown:function(f){var h=f.keyCode,j=b.current(),k=f.shiftKey,l=b.dataSource,m=b.options.pageable,n=!a(f.target).is(":button,a,:input,a>.t-icon"),o=b._editMode()=="incell",p,q,r=!1;n&&i.UP===h?(e(j?j.parent().prevAll(t).last().children(":eq("+j.index()+"),:eq(0)").last():d.find(x)),r=!0):n&&i.DOWN===h?(e(j?j.parent().nextAll(t).first().children(":eq("+j.index()+"),:eq(0)").last():d.find(x)),r=!0):n&&i.LEFT===h?(e(j?j.prevAll(u+":first"):d.find(x)),r=!0):n&&i.RIGHT===h?(e(j?j.nextAll(":visible:first"):d.find(x)),r=!0):n&&m&&i.PAGEDOWN==h?(b._current=null,l.page(l.page()+1),r=!0):n&&m&&i.PAGEUP==h?(b._current=null,l.page(l.page()-1),r=!0):b.options.editable&&(j=j?j:d.find(x),i.ENTER==h||i.F12==h?(b._handleEditing(j),r=!0):i.TAB==h&&o?(q=k?j.prevAll(u+":first"):j.nextAll(":visible:first"),q.length||(q=j.parent()[k?"prevAll":"nextAll"]("tr:not(.k-grouping-row,.k-detail-row):visible").children(u+(k?":last":":first"))),q.length&&(b._handleEditing(j,q),r=!0)):i.ESC==h&&b._editContainer&&(b._editContainer.has(j[0])||j[0]===b._editContainer[0])&&(o?b.closeCell():(p=b.items().index(j.parent()),document.activeElement.blur(),b.cancelRow(),p>=0&&b.current(b.items().eq(p).children().filter(u).first())),g.msie&&parseInt(g.version,10)<9&&document.body.focus(),c.focus(),r=!0)),r&&(f.preventDefault(),f.stopPropagation())}}),c.delegate(f,"mousedown",h))},_handleEditing:function(b,c){var d=this,e=d._editMode(),f=d._editContainer,g,h;e=="incell"?h=b.hasClass("k-edit-cell"):h=b.parent().hasClass("k-grid-edit-row");if(d.editable){a.contains(f[0],document.activeElement)&&a(document.activeElement).blur();if(d.editable.end())e=="incell"?d.closeCell():(b.parent()[0]===f[0]?g=d.items().index(b.parent()):g=d.items().index(f),d.saveRow(),d.current(d.items().eq(g).children().filter(u).first()),h=!0);else{e=="incell"?d.current(f):d.current(f.children().filter(u).first()),f.find(":input:visible:first").focus();return}}c&&d.current(c),d.wrapper.focus();if(!h&&!c||c)e=="incell"?d.editCell(d.current()):d.editRow(d.current().parent())},_wrapper:function(){var a=this,b=a.table,c=a.options.height,d=a.element;d.is("div")||(d=d.wrap("<div/>").parent()),a.wrapper=d.addClass("k-grid k-widget").attr(O,q.max(b.attr(O)||0,0)),b.removeAttr(O),c&&(a.wrapper.css(N,c),b.css(N,"auto"))},_tbody:function(){var b=this,c=b.table,d;d=c.find(">tbody"),d.length||(d=a("<tbody/>").appendTo(c)),b.tbody=d},_scrollable:function(){var b=this,d,e,f=b.options,g=f.scrollable,h=c.support.scrollbar();if(g){d=b.wrapper.children(".k-grid-header"),d[0]||(d=a('<div class="k-grid-header" />').insertBefore(b.table)),d.css("padding-right",g.virtual?h+1:h),e=a('<table cellspacing="0" />'),e.append(b.thead),d.empty().append(a('<div class="k-grid-header-wrap" />').append(e)),b.content=b.table.parent(),b.content.is(".k-virtual-scrollable-wrap")&&(b.content=b.content.parent()),b.content.is(".k-grid-content, .k-virtual-scrollable-wrap")||(b.content=b.table.wrap('<div class="k-grid-content" />').parent(),g!==!0&&g.virtual&&(b.virtualScrollable=new W(b.content,{dataSource:b.dataSource,itemHeight:n(b._averageRowHeight,b)}))),b.scrollables=d.children(".k-grid-header-wrap");if(g.virtual)b.content.find(">.k-virtual-scrollable-wrap").bind("scroll",function(){b.scrollables.scrollLeft(this.scrollLeft)});else{b.content.bind("scroll",function(){b.scrollables.scrollLeft(this.scrollLeft)});var i=c.touchScroller(b.content);i&&i.movable&&i.movable.bind("change",function(a){b.scrollables.scrollLeft(-a.sender.x)})}}},_setContentHeight:function(){var a=this,b=a.options,d=a.wrapper.innerHeight(),e=a.wrapper.children(".k-grid-header"),f=c.support.scrollbar();if(b.scrollable){d-=e.outerHeight(),a.pager&&(d-=a.pager.element.outerHeight()),b.groupable&&(d-=a.wrapper.children(".k-grouping-header").outerHeight()),b.toolbar&&(d-=a.wrapper.children(".k-grid-toolbar").outerHeight()),a.footerTemplate&&(d-=a.wrapper.children(".k-grid-footer").outerHeight());var g=function(a){var b,c;if(a[0].style.height)return!0;b=a.height(),a.height("auto"),c=a.height();if(b!=c){a.height("");return!0}a.height("");return!1};g(a.wrapper)&&(d>f*2?a.content.height(d):a.content.height(f*2+1))}},_averageRowHeight:function(){var a=this,b=a._rowHeight;a._rowHeight||(a._rowHeight=b=a.table.outerHeight()/a.table[0].rows.length,a._sum=b,a._measures=1);var c=a.table.outerHeight()/a.table[0].rows.length;b!==c&&(a._measures++,a._sum+=c,a._rowHeight=a._sum/a._measures);return b},_dataSource:function(){var a=this,c=a.options,d,f=c.dataSource;f=m(f)?{data:f}:f,j(f)&&(k(f,{table:a.table,fields:a.columns}),d=c.pageable,j(d)&&d.pageSize!==b&&(f.pageSize=d.pageSize)),a.dataSource&&a._refreshHandler?a.dataSource.unbind(C,a._refreshHandler).unbind(r,a._requestStartHandler).unbind(s,a._errorHandler):(a._refreshHandler=n(a.refresh,a),a._requestStartHandler=n(a._requestStart,a),a._errorHandler=n(a._error,a)),a.dataSource=e.create(f).bind(C,a._refreshHandler).bind(r,a._requestStartHandler).bind(s,a._errorHandler)},_error:function(){this._progress(!1)},_requestStart:function(){this._progress(!0)},_modelChange:function(b){var e=this,f=b.model,g=e.tbody.find("tr["+c.attr("uid")+"="+f.uid+"]"),h,i,j=g.hasClass("k-alt"),k,l,m;if(g.children(".k-edit-cell").length&&!e.options.rowTemplate)g.children(":not(.k-group-cell,.k-hierarchy-cell)").each(function(){h=a(this),i=e.columns[e.cellIndex(h)],i.field===b.field&&(h.hasClass("k-edit-cell")?h.addClass("k-dirty-cell"):(e._displayCell(h,i,f),a('<span class="k-dirty"/>').prependTo(h)))});else if(!g.hasClass("k-grid-edit-row")){k=a((j?e.altRowTemplate:e.rowTemplate)(f)),g.replaceWith(k);for(l=0,m=e.columns.length;l<m;l++)i=e.columns[l],i.field===b.field&&(h=k.children(":not(.k-group-cell,.k-hierarchy-cell)").eq(l),a('<span class="k-dirty"/>').prependTo(h));e.trigger("itemChange",{item:k,data:f,ns:d})}},_pageable:function(){var b=this,d,e=b.options.pageable;e&&(d=b.wrapper.children("div.k-grid-pager").empty(),d.length||(d=a('<div class="k-pager-wrap k-grid-pager"/>').appendTo(b.wrapper)),b.pager&&b.pager.destroy(),typeof e=="object"&&e instanceof c.ui.Pager?b.pager=e:b.pager=new c.ui.Pager(d,k({},e,{dataSource:b.dataSource})))},_footer:function(){var b=this,c=b.dataSource.aggregates(),d="",e=b.footerTemplate,f=b.options;if(e){c=p(c)?_(b.dataSource.aggregate()):c,d=a(b._wrapFooter(e(c)));if(b.footer){var g=d;b.footer.replaceWith(g),b.footer=g}else f.scrollable?(b.footer=f.pageable?d.insertBefore(b.wrapper.children("div.k-grid-pager")):d.appendTo(b.wrapper),b.scrollables=b.scrollables.add(b.footer.children(".k-grid-footer-wrap"))):b.footer=d.insertBefore(b.tbody);f.resizable&&b._footerWidth&&b.footer.find("table").css("width",b._footerWidth),b._setContentHeight()}},_wrapFooter:function(b){var c=this,d="";if(c.options.scrollable){d=a('<div class="k-grid-footer"><div class="k-grid-footer-wrap"><table cellspacing="0"><tbody>'+b+"</tbody></table></div></div>"),c._appendCols(d.find("table"));return d}return'<tfoot class="k-grid-footer">'+b+"</tfoot>"},_filterable:function(){var b=this,c=b.columns,d=b.options.filterable;d&&b.thead.find("th:not(.k-hierarchy-cell)").each(function(e){c[e].filterable!==!1&&a(this).kendoFilterMenu(k(!0,{},d,c[e].filterable,{dataSource:b.dataSource}))})},_sortable:function(){var b=this,c=b.columns,d,e=b.options.sortable;e&&b.thead.find("th:not(.k-hierarchy-cell)").each(function(f){d=c[f],d.sortable!==!1&&!d.command&&a(this).kendoSortable(k({},e,{dataSource:b.dataSource}))})},_columns:function(b){var d=this,e=d.table,f,g=e.find("col"),h=d.options.dataSource;b=b.length?b:l(e.find("th"),function(b,d){b=a(b);var e=b.attr(c.attr("sortable")),f=b.attr(c.attr("filterable")),h=b.attr(c.attr("type")),i=b.attr(c.attr("groupable")),j=b.attr(c.attr("field"));j||(j=b.text().replace(/\s|[^A-z0-9]/g,""));return{field:j,type:h,sortable:e!=="false",filterable:f!=="false",groupable:i!=="false",template:b.attr(c.attr("template")),width:g.eq(d).css("width")}}),f=!(d.table.find("tbody tr").length>0&&(!h||!h.transport)),d.columns=l(b,function(a){a=typeof a===Q?{field:a}:a;return k({encoded:f},a)})},_tmpl:function(a,b){var d=this,e=k({},c.Template,d.options.templateSettings),f,g=d.columns.length,h,i={storage:{},count:0},j,l,m=d._hasDetails(),o=[],p=d.dataSource.group().length;if(!a){a="<tr",b&&o.push("k-alt"),m&&o.push("k-master-row"),o.length&&(a+=' class="'+o.join(" ")+'"'),g&&(a+=" "+c.attr("uid")+'="#=uid#"'),a+=">",p>0&&(a+=X(p)),m&&(a+='<td class="k-hierarchy-cell"><a class="k-icon k-plus" href="\\#"></a></td>');for(f=0;f<g;f++)j=d.columns[f],h=j.template,l=typeof h,a+="<td>",a+=d._cellTmpl(j,i),a+="</td>";a+="</tr>"}a=c.template(a,e);if(i.count>0)return n(a,i.storage);return a},_cellTmpl:function(a,b){var d=this,e=k({},c.Template,d.options.templateSettings),f=a.template,g=e.paramName,h="",i,j,l=a.format,n=typeof f;if(a.command){if(m(a.command)){for(i=0,j=a.command.length;i<j;i++)h+=d._createButton(a.command[i]);return h.replace(U,"\\#")}return d._createButton(a.command).replace(U,"\\#")}n===P?(b.storage["tmpl"+b.count]=f,h+="#=this.tmpl"+b.count+"("+g+")#",b.count++):n===Q?h+=f:(h+=a.encoded?"${":"#=",l&&(h+='kendo.format("'+l.replace(S,"\\}")+'",'),e.useWithBlock||(h+=g+"."),h+=a.field,l&&(h+=")"),h+=a.encoded?"}":"#");return h},_templates:function(){var b=this,c=b.options,d=b.dataSource,e=d.group(),f=d.aggregate();b.rowTemplate=b._tmpl(c.rowTemplate),b.altRowTemplate=b._tmpl(c.altRowTemplate||c.rowTemplate,!0),b._hasDetails()&&(b.detailTemplate=b._detailTmpl(c.detailTemplate||""));if(!p(f)||a.grep(b.columns,function(a){return a.footerTemplate}).length)b.footerTemplate=b._footerTmpl(f,"footerTemplate","k-footer-template");e.length&&a.grep(b.columns,function(a){return a.groupFooterTemplate}).length&&(f=a.map(e,function(a){return a.aggregates}),b.groupFooterTemplate=b._footerTmpl(f,"groupFooterTemplate","k-group-footer"))},_footerTmpl:function(a,b,d){var e=this,f=k({},c.Template,e.options.templateSettings),g=f.paramName,h="",i,j,l=e.columns,m,o,p={},q=0,r={},s=e.dataSource,t=s.group().length,u=_(a),v;h+='<tr class="'+d+'">',t>0&&(h+=X(t)),e._hasDetails()&&(h+='<td class="k-hierarchy-cell">&nbsp;</td>');for(i=0,j=e.columns.length;i<j;i++)v=l[i],m=v[b],o=typeof m,h+="<td>",m?(o!==P&&(r=u[v.field]?k({},f,{paramName:g+"."+v.field}):{},m=c.template(m,r)),p["tmpl"+q]=m,h+="#=this.tmpl"+q+"("+g+")#",q++):h+=" ",h+="</td>";h+="</tr>",h=c.template(h,f);if(q>0)return n(h,p);return h},_detailTmpl:function(a){var b=this,d="",e=k({},c.Template,b.options.templateSettings),f=e.paramName,g={},h=0,i=b.dataSource.group().length,j=b.columns.length,l=typeof a;d+='<tr class="k-detail-row">',i>0&&(d+=X(i)),d+='<td class="k-hierarchy-cell"></td><td class="k-detail-cell"'+(j?' colspan="'+j+'"':"")+">",l===P?(g["tmpl"+h]=a,d+="#=this.tmpl"+h+"("+f+")#",h++):d+=a,d+="</td></tr>",d=c.template(d,e);if(h>0)return n(d,g);return d},_hasDetails:function(){var a=this;return a.options.detailTemplate!==b||(a._events[B]||[]).length},_details:function(){var b=this;b.table.delegate(".k-hierarchy-cell .k-plus, .k-hierarchy-cell .k-minus",M,function(c){var d=a(this),e=d.hasClass("k-plus"),f=d.closest("tr.k-master-row"),g,h=b.detailTemplate,i,j=b._hasDetails();d.toggleClass("k-plus",!e).toggleClass("k-minus",e),j&&!f.next().hasClass("k-detail-row")&&(i=b.dataItem(f),a(h(i)).insertAfter(f),b.trigger(B,{masterRow:f,detailRow:f.next(),data:i,detailCell:f.next().find(".k-detail-cell")})),g=f.next(),b.trigger(e?F:G,{masterRow:f,detailRow:g}),g.toggle(e),c.preventDefault();return!1})},dataItem:function(b){return this._data[this.tbody.find("> tr:not(.k-grouping-row,.k-detail-row,.k-group-footer)").index(a(b))]},expandRow:function(b){a(b).find("> td .k-plus, > td .k-expand").click()},collapseRow:function(b){a(b).find("> td .k-minus, > td .k-collapse").click()},_thead:function(){var d=this,e=d.columns,f=d._hasDetails()&&e.length,g,h,i="",j=d.table.find("thead"),k,l;j.length||(j=a("<thead/>").insertBefore(d.tbody)),k=d.table.find("tr").filter(":has(th)"),k.length||(k=j.children().first(),k.length||(k=a("<tr/>")));if(!k.children().length){f&&(i+='<th class="k-hierarchy-cell">&nbsp;</th>');for(g=0,h=e.length;g<h;g++)l=e[g],l.command?i+="<th>"+(l.title||"")+"</th>":(i+="<th "+c.attr("field")+"='"+l.field+"' ",l.title&&(i+=c.attr("title")+'="'+l.title.replace(/'/g,"'")+'" '),l.groupable!==b&&(i+=c.attr("groupable")+"='"+l.groupable+"' "),l.aggregates&&(i+=c.attr("aggregates")+"='"+l.aggregates+"'"),i+=">"+(l.title||l.field||"")+"</th>");k.html(i)}else f&&k.prepend('<th class="k-hierarchy-cell">&nbsp;</th>');k.find("th").addClass("k-header"),d.options.scrollable||j.addClass("k-grid-header"),k.appendTo(j),d.thead=j,d._sortable(),d._filterable(),d._scrollable(),d._updateCols(),d._setContentHeight(),d._resizable(),d._draggable(),d._reorderable()},_updateCols:function(){var a=this;a._appendCols(a.thead.parent().add(a.table))},_appendCols:function(b){var d=this,e=b.find("colgroup"),f,g=l(d.columns,function(a){f=a.width;if(f&&parseInt(f,10)!==0)return c.format('<col style="width:{0}"/>',typeof f===Q?f:f+"px");return"<col />"}),h=d.dataSource.group().length;d._hasDetails()&&g.splice(0,0,'<col class="k-hierarchy-col" />'),e.length&&e.remove(),e=a("<colgroup/>").append(a(Array(h+1).join('<col class="k-group-col">')+g.join(""))),b.prepend(e)},_autoColumns:function(a){if(a&&a.toJSON){var b=this,c;a=a.toJSON();for(c in a)b.columns.push({field:c});b._thead(),b._templates()}},_rowsHtml:function(a){var b=this,c="",d,e,f=b.rowTemplate,g=b.altRowTemplate;for(d=0,e=a.length;d<e;d++)d%2?c+=g(a[d]):c+=f(a[d]),b._data.push(a[d]);return c},_groupRowHtml:function(b,d,e){var f=this,g="",h,i,j=b.field,l=a.grep(f.columns,function(a){return a.field==j})[0]||{},m=l.format?c.format(l.format,b.value):b.value,n=l.groupHeaderTemplate,o=(l.title||j)+": "+m,p=k({},{field:b.field,value:b.value},b.aggregates[b.field]),q=b.items;n&&(o=typeof n===P?n(p):c.template(n)(p)),g+='<tr class="k-grouping-row">'+X(e)+'<td colspan="'+d+'">'+'<p class="k-reset">'+'<a class="k-icon k-collapse" href="#"></a>'+o+"</p></td></tr>";if(b.hasSubgroups)for(h=0,i=q.length;h<i;h++)g+=f._groupRowHtml(q[h],d-1,e+1);else g+=f._rowsHtml(q);f.groupFooterTemplate&&(g+=f.groupFooterTemplate(b.aggregates));return g},collapseGroup:function(b){b=a(b).find(".k-icon").addClass("k-expand").removeClass("k-collapse").end();var c=b.find(".k-group-cell").length,d=1,e,f;b.nextAll("tr").each(function(){f=a(this),e=f.find(".k-group-cell").length,f.hasClass("k-group-row")?d++:f.hasClass("k-group-footer")&&d--;if(e<=c||f.hasClass("k-group-footer")&&d<0)return!1;f.hide()})},expandGroup:function(b){b=a(b).find(".k-icon").addClass("k-collapse").removeClass("k-expand").end();var c=this,d=b.find(".k-group-cell").length;b.nextAll("tr").each(function(){var b=a(this),e=b.find(".k-group-cell").length;if(e<=d)return!1;e==d+1&&!b.hasClass("k-detail-row")&&(b.show(),b.hasClass("k-grouping-row")&&b.find(".k-icon").hasClass("k-collapse")&&c.expandGroup(b),b.hasClass("k-master-row")&&b.find(".k-icon").hasClass("k-minus")&&b.next().show())})},_updateHeader:function(b){var c=this,d=c.thead.find("th.k-group-cell"),e=d.length;b>e?a(Array(b-e+1).join('<th class="k-group-cell k-header">&nbsp;</th>')).prependTo(c.thead.find("tr")):b<e&&(e=e-b,a(a.grep(d,function(a,b){return e>b})).remove())},_firstDataItem:function(a,b){a&&b&&(a.hasSubgroups?a=this._firstDataItem(a.items[0],b):a=a.items[0]);return a},_progress:function(a){var b=this,d=b.element.is("table")?b.element.parent():b.content&&b.content.length?b.content:b.element;c.ui.progress(d,a)},refresh:function(b){var c=this,d,e,f="",h=c.dataSource.view(),i,j,k,l=c.current(),m=(c.dataSource.group()||[]).length,n=m+c.columns.length;if(!b||b.action!=="itemchange"||!c.editable){c.trigger("dataBinding"),l&&l.hasClass("k-state-focused")&&(k=c.items().index(l.parent())),c._destroyEditable(),c._progress(!1),c._data=[],c.columns.length||(c._autoColumns(c._firstDataItem(h[0],m)),n=m+c.columns.length),c._group=m>0||c._group,c._group&&(c._templates(),c._updateCols(),c._updateHeader(m),c._group=m>0);if(m>0){c.detailTemplate&&n++;for(e=0,d=h.length;e<d;e++)f+=c._groupRowHtml(h[e],n,0)}else f+=c._rowsHtml(h);g?c.tbody[0].innerHTML=f:(j=document.createElement("div"),j.innerHTML="<table><tbody>"+f+"</tbody></table>",i=j.firstChild.firstChild,c.table[0].replaceChild(i,c.tbody[0]),c.tbody=a(i)),c._footer(),k>=0&&c.current(c.items().eq(k).children().filter(u).first()),c.options.resizable&&c.positionColumnResizeHandles(),c.trigger(E)}}});d.plugin(bb),d.plugin(W)})(jQuery)